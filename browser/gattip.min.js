require=function e(r,t,i){function n(s,o){if(!t[s]){if(!r[s]){var c="function"==typeof require&&require;if(!o&&c)return c(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=t[s]={exports:{}};r[s][0].call(l.exports,function(e){var t=r[s][1][e];return n(t?t:e)},l,l.exports,e,r,t,i)}return t[s].exports}for(var a="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}({1:[function(e,r,t){function i(e,r,t){s.instantiateEmitter(this);var i=this,c=e.peripheral(),u=c.gattip(),l={},p={};a.requireUUID("Characteristic","uuid",r),this.uuid=r,t||(t={}),p=t,this.type="c",this.isNotifying=!1,this.gattip=function(){return u},this.peripheral=function(){return c},this.service=function(){return e},this.getAllDescriptors=function(){return l},this.findDescriptor=function(e){return l[e]},this.addDescriptorWithUUID=function(e){var r=new o(i,e);return l[e]=r},this.addDescriptor=function(e){return l[e.uuid]=e},this.hasProperty=function(e){return p[e]&&p[e].enabled},this.setProperty=function(e,r){return p[e]=r},this.allProperties=function(){return p},this.readValue=function(e){var r=a.populateParams(i);u.request(n.kGetCharacteristicValue,r,e,function(r){a.requireFields("Value",r,[n.kValue],[]),i.value=r[n.kValue],u.fulfill(e,i,i.value)})},this.writeValue=function(e,r){a.requireHexValue("writeValue","value",r);var t=a.populateParams(i);t[n.kValue]=r,u.request(n.kWriteCharacteristicValue,t,e,function(t){i.value=r,u.fulfill(e,i)})},this.enableNotifications=function(e,r){a.requireBooleanValue("enableNotifications","isNotifying",r);var t=a.populateParams(i);t[n.kIsNotifying]=r,u.request(n.kSetValueNotification,t,e,function(t){i.isNotifying=r,u.fulfill(e,i,r)})},this.handleValueNotification=function(e){i.value=e[n.kValue],i.emit("valueChange",i,i.value)},this.respondToReadRequest=function(e,r){a.requireHexValue("respondToReadRequest","value",r);var t=a.populateParams(i);t[n.kValue]=r,e.result=n.kGetCharacteristicValue,u.respond(e,t)},this.respondToWriteRequest=function(e){var r=a.populateParams(i);e.result=n.kWriteCharacteristicValue,u.respond(e,r)},this.respondToChangeNotification=function(e,r){var t=a.populateParams(i);a.requireBooleanValue("respondToChangeNotification","value",r),t[n.kIsNotifying]=r,this.isNotifying=r,e.result=n.kSetValueNotification,u.respond(e,t)},this.indicateValueChange=function(e){a.requireHexValue("writeValue","value",e);var r=a.populateParams(i);r[n.kValue]=e,u.sendIndications(n.kSetValueNotification,r)}}var n=e("./lib/constants.js").C,a=e("./lib/message-helper"),s=e("./lib/event-emitter"),o=e("./descriptor").Descriptor;s.makeEmitter(i),r.exports.Characteristic=i},{"./descriptor":2,"./lib/constants.js":6,"./lib/event-emitter":7,"./lib/message-helper":11}],2:[function(e,r,t){function i(e,r){var t=this,i=e.service(),s=i.peripheral(),o=s.gattip();a.requireUUID("Descriptor","uuid",r),this.uuid=r,this.type="d",this.characteristic=function(){return e},this.service=function(){return i},this.peripheral=function(){return s},this.gattip=function(){return o},this.readValue=function(e){var r=a.populateParams(t);o.request(n.kGetDescriptorValue,r,e,function(r){a.requireFields("readValue",r,[n.kValue],[]),t.value=r[n.kValue],o.fulfill(e,t,t.value)})},this.writeValue=function(e,r){var i=a.populateParams(t);a.requireHexValue("writeValue","value",r),o.request(n.kWriteDescriptorValue,i,e,function(i){t.value=r,o.fulfill(e,t)})},this.respondToReadRequest=function(e,r){var i=a.populateParams(t);a.requireHexValue("respondToReadRequest","value",r),i[n.kValue]=r,o.respond(e,i)},this.respondToWriteRequest=function(e){var r=a.populateParams(t);o.respond(e,r)}}var n=e("./lib/constants.js").C,a=e("./lib/message-helper");r.exports.Descriptor=i},{"./lib/constants.js":6,"./lib/message-helper":11}],3:[function(e,r,t){r.exports.ApplicationError=function(e){this.message="Application Error:"+e,Error.captureStackTrace(this,r.exports.ApplicationError)},r.exports.InternalError=function(e){this.message="Application Error:"+e,Error.captureStackTrace(this,r.exports.InternalError)},r.exports.GatewayError=function(e){"object"==typeof e?(this.message="Gateway Error:",e.message&&(this.message+=" "+e.message),e.code&&(this.message+=" Code:"+e.code),0==this.message.length&&(this.message="Unknown Gateway Error")):this.message=e,Error.captureStackTrace(this,r.exports.GatewayError)}},{}],4:[function(e,r,t){function i(e,r){c.instantiateEmitter(this);var t=this,i={};this.isScanning=!1,this.isPoweredOn=function(){return t.state==n.kPoweredOn},this._authenticate=function(r,i,a){var s={};s[n.kDeviceAccessToken]=i,s[n.kGetVersionInfo]=a,e.request(n.kOpen,s,r,function(i){if(i.isAuthenticated!==!0)throw new GatewayError({error:"Auth error"});e.fulfill(r,t)})},this.scan=function(r,i){var a={};i&&("boolean"==typeof i.scanDuplicates&&(a[n.kScanOptionAllowDuplicatesKey]=i.scanDuplicates),"object"==typeof i.services&&(a[n.kServiceUUIDs]=i.services)),e.request(n.kScanForPeripherals,a,r,function(i){t.isScanning=!0,e.fulfill(r,t)})},this.stopScan=function(r){e.request(n.kStopScanning,{},r,function(i){t.isScanning=!1,e.fulfill(r,t)})},this.centralState=function(r){e.request(n.kCentralState,{},r,function(i){t.state=i[n.kState],e.fulfill(r,t)})},this.configure=function(r,i,a){var s={};"undefined"!=typeof i&&(s[n.kShowPowerAlert]=i),"undefined"!=typeof a&&(s[n.kIdentifierKey]=a),e.request(n.kConfigure,{},r,function(i){e.fulfill(r,t)})},this.handleScanIndication=function(i){var o=i[n.kPeripheralUUID];if(!o)throw new s("Peripheral UUID is not availabvle");if(r&&r.uuids)for(var c in r.uuids){var u=r.uuids[c];if(u&&u.length&&u!=o)return}var l=t.getPeripheral(o);l?l._updateFromScanData(i[n.kPeripheralName],i[n.kRSSIkey],i[n.kCBAdvertisementDataTxPowerLevel],i[n.kCBAdvertisementDataServiceUUIDsKey],i[n.kCBAdvertisementDataManufacturerDataKey],i[n.kCBAdvertisementDataServiceDataKey],i[n.kAdvertisementDataKey],i[n.kScanRecord]):l=t.addPeripheral(new a(e,o,i[n.kPeripheralName],i[n.kRSSIkey],i[n.kCBAdvertisementDataTxPowerLevel],i[n.kCBAdvertisementDataServiceUUIDsKey],i[n.kCBAdvertisementDataManufacturerDataKey],i[n.kCBAdvertisementDataServiceDataKey],i[n.kAdvertisementDataKey],i[n.kScanRecord])),t.emit("scan",l)},this.addPeripheralWithValues=function(r,n,o,c,u,l,p){if(!r)throw new s("Attempting to add an empty peripheral");var f=t.addPeripheral(new a(e,r,n,o,c,u,l,p));return i[r]=f,f},this.addPeripheral=function(e){if(!e||!e.uuid)throw new s("Attempting to add an empty peripheral");return i[e.uuid]=e,e},this.removePeripheral=function(e){if(!e||!e.uuid)throw new s("Attempting to remove an empty peripheral");delete i[e.uuid]},this.getPeripheral=function(e){return i[e]},this.getPeripheralOrDie=function(e){var r=i[e];if(!r)throw new s("Unable to find peripheral with UUID "+e);return r},this.getObjects=function(e,r,t,n,a){var c={};if(c.peripheral=i[r],c.peripheral){if("p"===e)return c;if(c.service=c.peripheral.findService(t),c.service){if("s"===e)return c;if(c.characteristic=c.service.findCharacteristic(n),c.characteristic){if("c"===e)return c;if(c.descriptor=c.characteristic.findDescriptor(a),c.descriptor){if("d"===e)return c;throw new s('_getObjects: Argument "type" is required')}throw new o('Descriptor "'+a+'" not found in the service table')}throw new o('Characteristic "'+n+'" not found in the service table')}throw new o('Service "'+t+'" not found in the service table')}throw new o("Peripheral with id "+r+" not found")},this.getObjectsFromMessage=function(e,r){if(!r)throw new s("Message parameters are missing");try{return t.getObjects(e,r[n.kPeripheralUUID],r[n.kServiceUUID],r[n.kCharacteristicUUID],r[n.kDescriptorUUID])}catch(e){throw new s(e.message,e.detail)}}}var n=e("./lib/constants").C,a=(e("./lib/message-helper"),e("./peripheral").Peripheral),s=e("./errors").InternalError,o=e("./errors").ApplicationError,c=e("./lib/event-emitter");c.makeEmitter(i),r.exports.Gateway=i},{"./errors":3,"./lib/constants":6,"./lib/event-emitter":7,"./lib/message-helper":11,"./peripheral":15}],5:[function(e,r,t){function i(){function r(e){m.emit("error",e)}function t(e,t,i){try{e&&(t=JSON.parse(t)),i(t)}catch(e){r(e)}}n.instantiateEmitter(this),this.traceEnabled=!1;var i,h,d,v,k,m=this;this.getGateway=function(){return k},this.traceMessage=function(e,r){m.traceEnabled&&"object"==typeof e&&(e=JSON.stringify(e))},this.getServerMessageHandler=function(){return v||r(new o("Server Message Handler is not Ready")),v},this.fulfill=function(e,r,t,i,n,a){"object"==typeof e&&"function"==typeof e.fulfill?e.fulfill(r,t,i,n,a):"function"==typeof e&&e(r,t,i,n,a)},this.reject=function(e,t){"object"==typeof e&&"function"==typeof e.reject?e.reject(t):r(t)},this.open=function(n){function E(e){e.isServer?(h.on("request",function(e){m.traceMessage(e,"<req:"),t(!1,e,v.processMessage)}),h.on("indication",function(e){r(new s("Received an indication on a server stream:"+JSON.stringify(e)))}),k=S,m.emit("ready",S)):S.configure(function(){S.centralState(function(){if(S.isPoweredOn())S.isPoweredOn()&&I();else{m.emit("state","Bluetooth not power on");var e=setInterval(function(){S.centralState(function(){S.isPoweredOn()&&(clearInterval(e),I())})},500)}})})}function I(){h.on("indication",function(e){m.traceMessage(e,"<ind:"),t(!1,e,d.handleIndication)}),h.on("request",function(e){r(new a("Received a request on a client stream:"+JSON.stringify(e)))}),k=S,m.emit("ready",S)}function g(e){e.token?S._authenticate(function(){E(e)},e.token,e.version):E(e)}var S=new l(this,n.scanFilters);if(h=new u(this),d=new c(this,S),v=new p(this,S),n.trace===!0&&(m.traceEnabled=!0),n.url){var P;P="object"==typeof window?window.WebSocket:e("websocket").w3cwebsocket,i=new P(n.url,(void 0),(void 0),(void 0),(void 0),f),i.onopen=function(){g(n)},i.onclose=function(e){m.emit("onclose",e)},i.onerror=function(e){m.emit("onerror",e)}}else{if(!n.stream)throw new s("URL or stream implementing a socket interface is required");i=n.stream,g(n)}i.onmessage=function(e){t(!0,e.data,h.onMessageReceived)},h.on("response",function(e,r){m.traceMessage(e,"<rsp:");try{e.error?m.reject(r.cb,new o(e.error)):r.handler?r.handler(e.params):m.fulfill(r.cb)}catch(e){m.reject(r.cb,e)}}),h.on("error",function(e){m.emit("error",e)})},this.close=function(){i&&i.close()},this.request=function(e,r,t,n){var a=d.createUserContext(e,r,t,n),s=a.originalMessage;h.register(s,a),m.traceMessage(s,">req:"),i.send(JSON.stringify(s))},this.respond=function(e,r){var t=d.wrapResponse(e,r);m.traceMessage(t,">rsp:"),i.send(JSON.stringify(t))},this.sendIndications=function(e,r){var t={params:r,jsonrpc:"2.0"};t.result=e,t.params=r,m.traceMessage(t,">rsp:"),i.send(JSON.stringify(t))},this.sendError=function(e){e.jsonrpc="2.0",m.traceMessage(e,">rsp:"),i.send(JSON.stringify(e))}}var n=e("./lib/event-emitter"),a=e("./errors").InternalError,s=e("./errors").ApplicationError,o=e("./errors").GatewayError,c=e("./lib/message-handler").MessageHandler,u=e("./lib/message-processor").MessageProcessor,l=e("./gateway").Gateway,p=(e("./lib/message-helper"),e("./lib/server-message-handler").ServerMessageHandler),f={keepalive:!0,dropConnectionOnKeepaliveTimeout:!0,keepaliveInterval:1e4,keepaliveGracePeriod:1e4};n.makeEmitter(i),r.exports.GATTIP=i},{"./errors":3,"./gateway":4,"./lib/event-emitter":7,"./lib/message-handler":10,"./lib/message-helper":11,"./lib/message-processor":12,"./lib/server-message-handler":13,websocket:17}],6:[function(e,r,t){var i={DEFAULT_MESSAGE_TIMEOUT_MS:61e3,MAX_PENDING_MESSAGES:200,NUM_CONNECT_ATTEMPTS:3,kMessageId:"id",kSessionId:"session_id",kAuthenticate:"aut",kOpen:"opn",kDeviceAccessToken:"dat",kGetVersionInfo:"vif",kError:"error",kCode:"code",kMessageField:"message",kMethod:"method",kResult:"result",kIdField:"id",kConfigure:"aa",kScanForPeripherals:"ab",kStopScanning:"ac",kConnect:"ad",kDisconnect:"ae",kCentralState:"af",kGetConnectedPeripherals:"ag",kGetPerhipheralsWithServices:"ah",kGetPerhipheralsWithIdentifiers:"ai",kGetServices:"ak",kGetIncludedServices:"al",kGetCharacteristics:"am",kGetDescriptors:"an",kGetCharacteristicValue:"ao",kGetDescriptorValue:"ap",kWriteCharacteristicValue:"aq",kWriteDescriptorValue:"ar",kSetValueNotification:"as",kGetPeripheralState:"at",kGetRSSI:"au",kInvalidatedServices:"av",kPeripheralNameUpdate:"aw",kMessage:"zz",kCentralUUID:"ba",kPeripheralUUID:"bb",kPeripheralName:"bc",kPeripheralUUIDs:"bd",kServiceUUID:"be",kServiceUUIDs:"bf",kPeripherals:"bg",kIncludedServiceUUIDs:"bh",kCharacteristicUUID:"bi",kCharacteristicUUIDs:"bj",kDescriptorUUID:"bk",kServices:"bl",kCharacteristics:"bm",kDescriptors:"bn",kProperties:"bo",kValue:"bp",kState:"bq",kStateInfo:"br",kStateField:"bs",kWriteType:"bt",kRSSIkey:"bu",kIsPrimaryKey:"bv",kIsBroadcasted:"bw",kIsNotifying:"bx",kShowPowerAlert:"by",kIdentifierKey:"bz",kScanOptionAllowDuplicatesKey:"b0",kScanOptionSolicitedServiceUUIDs:"b1",kAdvertisementDataKey:"b2",kCBAdvertisementDataManufacturerDataKey:"mfr",kCBAdvertisementDataServiceUUIDsKey:"suu",kCBAdvertisementDataServiceDataKey:"sdt",kCBAdvertisementDataOverflowServiceUUIDsKey:"b6",kCBAdvertisementDataSolicitedServiceUUIDsKey:"b7",kCBAdvertisementDataIsConnectable:"b8",kCBAdvertisementDataTxPowerLevel:"txp",kPeripheralBtAddress:"c1",kRawAdvertisementData:"c2",kScanRecord:"c3",kCBCentralManagerRestoredStatePeripheralsKey:"da",kCBCentralManagerRestoredStateScanServicesKey:"db",kWriteWithResponse:"cc",kWriteWithoutResponse:"cd",kNotifyOnConnection:"ce",kNotifyOnDisconnection:"cf",kNotifyOnNotification:"cg",kDisconnected:"ch",kConnecting:"ci",kConnected:"cj",kUnknown:"ck",kResetting:"cl",kUnsupported:"cm",kUnauthorized:"cn",kPoweredOff:"co",kPoweredOn:"cp",kErrorPeripheralNotFound:"-32001",kErrorServiceNotFound:"-32002",kErrorCharacteristicNotFound:"-32003",kErrorDescriptorNotFound:"-32004",kErrorPeripheralStateIsNotValid:"-32005",kErrorNoServiceSpecified:"-32006",kErrorNoPeripheralIdentiferSpecified:"-32007",kErrorStateRestorationNotValid:"-32008",kInvalidRequest:"-32600",kMethodNotFound:"-32601",kInvalidParams:"-32602",kError32603:"-32603",kParseError:"-32700",kGAP_ADTYPE_FLAGS:"01",kGAP_ADTYPE_INCOMPLETE_16BIT_SERVICEUUID:"02",kGAP_ADTYPE_COMPLETE_16BIT_SERVICEUUID:"03",kGAP_ADTYPE_INCOMPLETE_32BIT_SERVICEUUID:"04",kGAP_ADTYPE_COMPLETE_32BIT_SERVICEUUID:"05",kGAP_ADTYPE_INCOMPLETE_128BIT_SERVICEUUID:"06",kGAP_ADTYPE_COMPLETE_128BIT_SERVICEUUID:"07",kGAP_ADTYPE_POWER_LEVEL:"0A",kGAP_ADTYPE_MANUFACTURER_SPECIFIC:"FF",kGAP_ADTYPE_16BIT_SERVICE_DATA:"16",id:1,authenticate:"authenticate",AllProperties:["Broadcast","Read","WriteWithoutResponse","Write","Notify","Indicate","AuthenticatedSignedWrites","ExtendedProperties","NotifyEncryptionRequired","IndicateEncryptionRequired"]};r.exports.C=i},{}],7:[function(e,r,t){var i=e("events"),n=e("util");r.exports.makeEmitter=function(e){n.inherits(e,i)},r.exports.instantiateEmitter=function(e){i.call(e)}},{events:18,util:22}],8:[function(e,r,t){function i(){function r(e,r){var t=r?"0x":"";for(var i in e){var n=(255&e[i]).toString(16);1==n.length&&(n="0"+n),t+=n}return t}function t(e){for(var r in e)if(e.hasOwnProperty(r))return!1;return JSON.stringify(e)===JSON.stringify({})}function i(e){var r={};if(e&&e.getAllServices())for(var t in e.getAllServices()){var i={};i[n.kServiceUUID]=t,i[n.kIsPrimaryKey]=e.findService(t).isPrimary,i[n.kCharacteristics]=o(e.findService(t)),r[t]=i}return r}function o(e){var r={};if(e&&e.getAllCharacteristics())for(var t in e.getAllCharacteristics()){var i={};i[n.kCharacteristicUUID]=t,i[n.kValue]=e.findCharacteristic(t).value,i[n.kProperties]=e.findCharacteristic(t).allProperties(),i[n.kIsNotifying]=e.findCharacteristic(t).isNotifying,i[n.kDescriptors]=c(e.findCharacteristic(t)),r[t]=i}return r}function c(e){var r={};if(e&&e.getAllDescriptors())for(var t in e.getAllDescriptors()){var i={};i[n.kDescriptorUUID]=t,i[n.kValue]=e.findDescriptor(t).value,i[n.kProperties]=e.findDescriptor(t).properties,i[n.kIsNotifying]=e.findDescriptor(t).isNotifying,r[t]=i}return r}s.instantiateEmitter(this);var u,l=this;this.peripherals={},this.init=function(r,t){t&&(this.oninit=t),"object"!=typeof window&&(WebSocket=e("websocket").w3cwebsocket),l.socket=new WebSocket(r),l.socket.onopen=function(){l.initWithServer(l.socket),l.oninit&&l.oninit()}},this.initWithServer=function(e){if(u=e,!u.send)throw new Error("server must implement the send method");u.onmessage=l.processMessage,u.onclose||(u.onclose=function(){}),u.onerror||(u.onerror=function(e){}),u.error||(u.onerror=function(e){})},this.processMessage=function(e){function r(e){var r=u[n.kPeripheralUUID],i={};if(i.peripheral=l.peripherals[r],i.peripheral&&i.peripheral.uuid){if("p"===e)return i;var a=u[n.kServiceUUID];if(i.service=i.peripheral.findService(a),i.service&&i.service.uuid){if("s"===e)return i;var s=u[n.kCharacteristicUUID];if(i.characteristic=i.service.findCharacteristic(s),i.characteristic&&i.characteristic.uuid){if("c"===e)return i;var o=u[n.kDescriptorUUID];if(i.descriptor=i.characteristic.findDescriptor(o),i.descriptor&&i.descriptor.uuid)return i;throw l.sendErrorResponse(t.method,n.kErrorDescriptorNotFound,"Descriptor not found in the service database"),new Error("Descriptor not found")}throw l.sendErrorResponse(t.method,n.kErrorCharacteristicNotFound,"Characteristic not found in the service database"),new Error("Characteristic not found")}throw l.sendErrorResponse(t.method,n.kErrorServiceNotFound,"Service not found in the service database"),new Error("Service not found")}throw l.sendErrorResponse(t.method,n.kErrorPeripheralNotFound,"Peripheral not found in the service database"),new Error("Peripheral not found")}try{var t=JSON.parse(e.data)}catch(e){}if("undefined"!=typeof t&&t&&!t.error){var i;if(t.result&&(t.result==n.kMessage||t.result==n.kAuthenticate)){var a=!1;return t.error||"object"!=typeof t.params||t.params[n.kAuthenticate]!==!0||(a=!0),void l.emit("authenticated",a)}if(t.method&&t.method==n.kAuthenticate){var s={};s[n.kAuthenticate]=!0;var o={};return o.result=n.kAuthenticate,o.params=s,o[n.kIdField]=t[n.kIdField],o=JSON.stringify(o),void l.send(o)}var c={id:t.id,session_id:t.session_id,method:t.method},u=t.params;switch(t.method){case n.kConfigure:l.emit("configure",c,u[n.kShowPowerAlert],u[n.kIdentifierKey]);break;case n.kScanForPeripherals:l.emit("scan",c,u[n.kScanOptionAllowDuplicatesKey],u[n.kServiceUUIDs]);break;case n.kStopScanning:l.emit("stopScan",c);break;case n.kCentralState:l.emit("getCentralState",c);break;case n.kConnect:try{i=r("p"),l.emit("connect",c,i.peripheral.uuid)}catch(e){}break;case n.kDisconnect:try{i=r("p"),l.emit("disconnect",c,i.peripheral.uuid)}catch(e){}break;case n.kGetCharacteristicValue:try{i=r("c",c),l.emit("readCharacteristic",c,i.peripheral.uuid,i.service.uuid,i.characteristic.uuid)}catch(e){}break;case n.kWriteCharacteristicValue:try{i=r("c",c),l.emit("writeCharacteristic",c,i.peripheral.uuid,i.service.uuid,i.characteristic.uuid,t.params[n.kValue])}catch(e){}break;case n.kSetValueNotification:try{i=r("c",c),i.characteristic.isNotifying=t.params[n.kValue],l.emit("enableNotifications",c,i.peripheral.uuid,i.service.uuid,i.characteristic.uuid,t.params[n.kIsNotifying])}catch(e){}break;case n.kGetDescriptorValue:try{i=r("d",c),l.emit("readDescriptor",c,i.peripheral.uuid,i.service.uuid,i.characteristic.uuid,i.descriptor.uuid)}catch(e){}break;case n.kWriteDescriptorValue:try{i=r("d",c),l.emit("writeDescriptor",c,i.peripheral.uuid,i.service.uuid,i.characteristic.uuid,i.descriptor.uuid,t.params[n.kValue])}catch(e){}break;default:return void l.sendErrorResponse(c,t.method,n.kInvalidRequest,"Request not handled by server")}}},this.sendErrorResponse=function(e,r,t,i){var a={};params={},a[n.kCode]=t,a[n.kMessageField]=i,params[n.kError]=a,l.write(r,void 0,e,a)},this.authenticate=function(e,r){params={},params[n.kDeviceAccessToken]=e,params[n.kGetVersionInfo]=r;var t={};t.method=n.kAuthenticate,t.params=params,t.id=n.id.toString(),n.id+=1,this.send(JSON.stringify(t))},this.configureResponse=function(e,r){r?l.sendErrorResponse(e,n.kConfigure,void 0):l.write(n.kConfigure,void 0,e)},this.centralStateResponse=function(e,r,t){t?l.sendErrorResponse(e,n.kCentralState,void 0):(params={},params[n.kState]=r,l.write(n.kCentralState,params,e))},this.scanResponse=function(e,i,a,s,o,c,u,p){params={};var f,h;if(!t(u)){f={};for(var d in u){var v=d.toUpperCase();f[v]=r(u[d]).toUpperCase()}}if(!t(p)){h={};for(var k in p){var m=k.toUpperCase();h[m]=r(p[k]).toUpperCase()}}params[n.kPeripheralName]=a,params[n.kPeripheralUUID]=i,params[n.kRSSIkey]=s,params[n.kCBAdvertisementDataTxPowerLevel]=o,params[n.kCBAdvertisementDataServiceUUIDsKey]=c&&c.length>0?c:void 0,params[n.kCBAdvertisementDataManufacturerDataKey]=f,params[n.kCBAdvertisementDataServiceDataKey]=h,l.write(n.kScanForPeripherals,params,e)},this.stopScanResponse=function(e,r){r?this.sendErrorResponse(e,n.kStopScanning,r):l.write(n.kStopScanning,void 0,e)},this.connectResponse=function(e,r,t){var a={};a[n.kPeripheralUUID]=r.uuid,a[n.kPeripheralName]=r.name;var s={};s=i(r),a[n.kServices]=s,t?l.sendErrorResponse(e,n.kConnect,t):l.write(n.kConnect,a,e)},this.disconnectResponse=function(e,r,t){t?l.sendErrorResponse(e,n.kDisconnect,t):(params={},params[n.kPeripheralUUID]=r.uuid,params[n.kPeripheralName]=r.name,l.write(n.kDisconnect,params))},this.write=function(e,r,t,i){var n={};n.jsonrpc="2.0",n.result=e,n.params=r,n.error=i,t&&(n.id=t.id,n.session_id=t.session_id),l.send(JSON.stringify(n))},this.send=function(e){return u?void(1===u.readyState&&u.send(e)):void l.onerror("not connected")},this.close=function(e){u&&u.close()},this.addPeripheral=function(e,r,t,i,n){var s=new a(this,e,r,t,i,n);return l.peripherals[s.uuid]=s,s},this.GATM_SECURITY_PROPERTIES_NO_SECURITY=0,this.GATM_SECURITY_PROPERTIES_UNAUTHENTICATED_ENCRYPTION_WRITE=1,this.GATM_SECURITY_PROPERTIES_AUTHENTICATED_ENCRYPTION_WRITE=2,this.GATM_SECURITY_PROPERTIES_UNAUTHENTICATED_ENCRYPTION_READ=4,this.GATM_SECURITY_PROPERTIES_AUTHENTICATED_ENCRYPTION_READ=8,this.GATM_SECURITY_PROPERTIES_UNAUTHENTICATED_SIGNED_WRITES=16,this.GATM_SECURITY_PROPERTIES_AUTHENTICATED_SIGNED_WRITES=32,this.GATM_CHARACTERISTIC_PROPERTIES_BROADCAST=1,this.GATM_CHARACTERISTIC_PROPERTIES_READ=2,this.GATM_CHARACTERISTIC_PROPERTIES_WRITE_WO_RESP=4,this.GATM_CHARACTERISTIC_PROPERTIES_WRITE=8,this.GATM_CHARACTERISTIC_PROPERTIES_NOTIFY=16,this.GATM_CHARACTERISTIC_PROPERTIES_INDICATE=32,this.GATM_CHARACTERISTIC_PROPERTIES_AUTHENTICATED_SIGNED_WRITES=64,this.GATM_CHARACTERISTIC_PROPERTIES_EXT_PROPERTIES=128,this.GATM_DESCRIPTOR_PROPERTIES_READ=1,this.GATM_DESCRIPTOR_PROPERTIES_WRITE=2}var n=e("./constants.js").C,a=e("../peripheral.js").Peripheral,s=e("./event-emitter");s.makeEmitter(i),r.exports.GattIpServer=i},{"../peripheral.js":15,"./constants.js":6,"./event-emitter":7,websocket:17}],9:[function(e,r,t){function i(e,r){var t=parseInt(r[0],16);parseInt(r[2],16)>=1?e.discoverable="true":e.discoverable="false",r.splice(0,t+1)}function n(e,r){var t=parseInt(r[0],16);e.txPowerLevel=parseInt(r[2]),r.splice(0,t+1)}function a(e,r){var t=parseInt(r[0],16);if(t>2){for(var i=r[3]+r[2],n="",a=4;a<=t;a++)n+=r[a];e.manufacturerData[i]=n}r.splice(0,t+1)}function s(e,r){for(var t=parseInt(r[0],16),i="",n=t;n>=2;n--)i+=r[n];e.serviceUUIDs=i,r.splice(0,t+1)}function o(e,r){for(var t=parseInt(r[0],16),i="",n=t;n>=2;n--)i+=r[n],14!=n&&12!=n&&10!=n&&8!=n||(i+="-");e.serviceUUIDs=i,r.splice(0,t+1)}function c(e,r){for(var t=parseInt(r[0],16),i="",n=3;n>=2;n--)i+=r[n];"FEAA"==i&&(0===parseInt(r[4],16)?u(e):16==parseInt(r[4],16)?l(e):32==parseInt(r[4],16)&&p(e)),r.splice(0,t+1)}function u(e,r){e.frameType="UID",e.nameSpace="",e.instanceID="",e.txPowerLevel=parseInt(r[5],16);for(var t=6;t<16;t++)e.nameSpace+=r[t];for(var i=16;i<22;i++)e.instanceID+=r[i];e.reserved=r[22],e.reserved+=r[23]}function l(e,r){e.frameType="URL",e.txPowerLevel=parseInt(r[5]);for(var t in f.AllProtocols)r[6]==t&&(e.url=f.AllProtocols[t]);for(var i=7;i<advArrayLength;i++)e.url+=String.fromCharCode(parseInt(r[i],16));for(var n in f.AllDomains)r[advArrayLength]==n&&(e.url+=f.AllDomains[n])}function p(e,r){e.frameType="TLM",e.advPacketCount="",e.timeInterval="",e.batteryVoltage="",e.eddyVersion=parseInt(r[5],16);for(var t=6;t<8;t++)e.batteryVoltage+=r[t];e.batteryVoltage=parseInt(e.batteryVoltage,16),e.temperature=Math.ceil(parseInt(r[8],16)),e.temperature+=".";var i=Math.ceil(1/256*parseInt(r[9],16));i.length>2?e.temperature+=i.toString().substring(0,2):e.temperature+=i;for(var n=10;n<14;n++)e.advPacketCount+=r[n];e.advPacketCount=parseInt(e.advPacketCount,16);for(var a=14;a<18;a++)e.timeInterval+=r[a];if(e.timeInterval=Math.ceil(.1*parseInt(e.timeInterval,16)),e.timePeriod="",e.timeInterval>=60){var s=Math.floor(e.timeInterval/86400);s>0&&(e.timePeriod+=s<10?s+"day ":s+"days ",e.timeInterval-=24*s*60*60);var o=Math.floor(e.timeInterval/3600);o>0?(e.timePeriod+=o<10?"0"+o+":":o+":",e.timeInterval-=60*o*60):e.timePeriod+="00:";var c=Math.floor(e.timeInterval/60);c>0?(e.timePeriod+=c<10?"0"+c+":":c+":",e.timeInterval-=60*c,e.timePeriod+=e.timeInterval<10?"0"+e.timeInterval:e.timeInterval,e.timePeriod+=" secs",e.timeInterval=0):(e.timePeriod+="00:"+e.timeInterval,e.timeInterval=0)}else e.timeInterval>0&&e.timeInterval<60&&(e.timePeriod+=e.timeInterval<10?"00:00:0"+e.timeInterval:"00:00:"+e.timeInterval,e.timePeriod+=" secs")}var f=e("./constants").C;r.exports.parseAdvArray=function(e,r){e.advdata||(e.advdata={});var t=e.advdata;if(t.manufacturerData||(t.manufacturerData={}),t.serviceUUIDs||(t.serviceUUIDs=[]),!r)return[];var u=[];if(r.length%2===0)for(var l=0;l<r.length;l+=2)u[l/2]=r.charAt(l)+r.charAt(l+1);else for(var p=0;p<r.length;p++)u[p]=r.charAt(2*p)+r.charAt(2*p+1);for(;;){var h=u[1];if(h==f.kGAP_ADTYPE_FLAGS)i(t,u);else if(h==f.kGAP_ADTYPE_POWER_LEVEL)n(t,u);else if(h==f.kGAP_ADTYPE_INCOMPLETE_16BIT_SERVICEUUID||h==f.kGAP_ADTYPE_COMPLETE_16BIT_SERVICEUUID)s(t,u);else if(h==f.kGAP_ADTYPE_INCOMPLETE_32BIT_SERVICEUUID||h==f.kGAP_ADTYPE_COMPLETE_32BIT_SERVICEUUID)s(t,u);else if(h==f.kGAP_ADTYPE_INCOMPLETE_128BIT_SERVICEUUID||h==f.kGAP_ADTYPE_COMPLETE_128BIT_SERVICEUUID)o(t,u);else if(h==f.kGAP_ADTYPE_MANUFACTURER_SPECIFIC)a(t,u);else if(h==f.kGAP_ADTYPE_16BIT_SERVICE_DATA)c(t,u);else if("00"==h)u.splice(0,1);else{var d=parseInt(u[0],16);u.splice(0,d+1)}if(0===u.length)break}}},{"./constants":6}],10:[function(e,r,t){var i=e("./constants").C,n=e("./message-helper"),a=e("./../errors").InternalError,s=e("./../errors").ApplicationError;r.exports.MessageHandler=function(e,r){this.createUserContext=function(e,r,t,i){var n={method:e,params:r,jsonrpc:"2.0"};return{originalMessage:n,cb:t,handler:i}},this.wrapResponse=function(e,r){var t={params:r,jsonrpc:"2.0"};return n.requireAndPopulateFieldsFromCookie("wrapResponse",e,t),t},this.handleIndication=function(e){if(e.error)throw new s(JSON.stringify(e));var t=e.params;switch(e.result){case i.kScanForPeripherals:r.handleScanIndication(t);break;case i.kDisconnect:!function(){n.requireFields("Disconnect indication",t,[i.kPeripheralUUID]);var e=r.getPeripheral(t[i.kPeripheralUUID]);e&&e.handleDisconnectIndication(e)}();break;case i.kSetValueNotification:!function(){n.requireFields("Disconnect indication",t,[i.kPeripheralUUID]);var a=r.getPeripheral(t[i.kPeripheralUUID]);if(a){n.requireFields("Value notification",t,[i.kPeripheralUUID,i.kServiceUUID,i.kCharacteristicUUID,i.kValue]);var s=r.getObjectsFromMessage("c",e.params);s.characteristic.handleValueNotification(t)}}();break;default:!function(){throw new a("Unknown indication received from the gateway:",JSON.stringify(e))}()}}}},{"./../errors":3,"./constants":6,"./message-helper":11}],11:[function(e,r,t){function i(e){var r="";if("object"==typeof e){if(Array.isArray(e)){for(var t in e)0!=t&&(r+=" ,"),r+=e[t]}for(var n in e)if(e.hasOwnProperty(n)){var s=e[n],o=a[n];o||(o=n),r+="object"==typeof s?Array.isArray(s)?" "+o+":["+i(s)+"]":" "+o+":{"+i(s)+"}":" "+o+"="+s}}return r}var n=e("./constants").C,a={},s=e("./../errors").InternalError,o=e("./../errors").ApplicationError;for(var c in n){var u=n[c];0==c.indexOf("k")&&(c=c.substring(1,c.length),a[u]=c)}r.exports.toString=function(e){return i(e.params).trim()},r.exports.requireAndAssignParameters=function(e,t,i,n){r.exports.requireFields(e+" call parameters ",t,i,n)},r.exports.requireBooleanValue=function(e,r,t){if("boolean"!=typeof t)throw new o(e+" missing parameter "+r)},r.exports.requireHexValue=function(e,r,t){if("string"!=typeof t)throw new o(e+" missing parameter "+r);if(t.length<2||t.length%2!=0||!/^[0-9a-fA-F]+$/.test(t))throw new o(e+" value "+r+" is not a valid hex string")},r.exports.requireUUID=function(e,r,t){if("string"!=typeof t)throw new o(e+" missing parameter "+r);if(t.length<4||!/^[0-9A-F-]+$/.test(t))throw new o(e+" value "+r+" is not a valid UUID")},r.exports.requireHexValues=function(e,r,t){var i=[];if(!Array.isArray(r)||!Array.isArray(t))throw new s("Illegal use of requireHexValues");for(var n in r){var a=r[n],c=t[n];("string"!=typeof c||c.length<2||c.length%2!=0||!/^#[0-9A-F]$/i.test(c))&&i.push(a)}if(i)throw new o(e+" missing parameters "+i)},r.exports.requireFields=function(e,r,t,i){var n=[];if(i||(i={}),!r)throw new s(e+"Object is undefined");for(var a in t){var o=t[a];void 0==typeof r[o]&&(void 0==typeof i[a]?n.push(t):r[o]=i[a])}if(n.length)throw new s(e+" missing "+n)},r.exports.requireAndPopulateFieldsFromCookie=function(e,r,t){if(!r)throw new o('Error: "'+e+" is missing the cookie");if(!r.original.id)throw new o('Error: "'+e+" is missing the cookie ID");if(!r.original.session_id)throw new o('Error: "'+e+" is missing the cookie session ID");if(!r.original.method)throw new o('Error: "'+e+" is missing the cookie request");t[n.kMessageId]=r.original.id,t[n.kSessionId]=r.original.session_id,t.result=r.result},r.exports.populateParams=function(e,r){function t(e,t){u--;var i=t.uuid;if(!i)throw new s('UUID for object of type "'+t.type+'" is missing');r[e]=i}if(r||(r={}),!e)throw new s("populateParams: service object is undefined");var i,a,o,c,u=23132;switch(e.type){case"d":u=4,c=e;break;case"c":u=3,o=e;break;case"s":u=2,a=e;break;case"p":u=1,i=e;break;default:throw new s('type must be one of: "s", "c" or "d"')}if(c&&(t(n.kDescriptorUUID,c),o=c.characteristic()),o&&(t(n.kCharacteristicUUID,o),a=o.service()),a&&(t(n.kServiceUUID,a),i=o.peripheral()),i&&t(n.kPeripheralUUID,i),0!=u)throw new s("Expected "+u+" more parts when constructing params of "+e.type);return r}},{"./../errors":3,"./constants":6}],12:[function(e,r,t){function i(e,r,t,i){this.msg=r,this.userContext=t,"undefined"==typeof r.id&&(r.id=Number(c++).toString()),this.id=r.id,i||(i=s.DEFAULT_MESSAGE_TIMEOUT_MS);var n=this;this.timeout=setTimeout(function(){delete n.timeout,e.emit("error",new o("Timed out : "+JSON.stringify(r)),n.userContext.cb)},i)}function n(){a.instantiateEmitter(this);var e=this,r={};this.register=function(t,n,a){if(Object.keys(r).length>s.MAX_PENDING_MESSAGES)throw new o("Message queue is full",t);var c=new i(e,t,n,a);return r[c.id]=c,c.msg},this.hasMessage=function(e){var t=r[""+e];return!!t},this.onMessageReceived=function(t){var i;if(t.params&&t.params.id&&(t.id=t.params.id),t.id&&(i=r[""+t.id]),!i){if(t.id)return t.result==s.kScanForPeripherals&&t.params&&t.params.bb?(l||(l=!0),void e.emit("indication",t)):void e.emit("request",t);if(t.result!=s.kMessage)return void e.emit("indication",t);u||(u=!0),t.id="1",i=r[1]}i.timeout&&clearTimeout(i.timeout),delete r[t.id],e.emit("response",t,i.userContext,i.msg)}}var a=e("./event-emitter"),s=e("./constants").C,o=e("./../errors").ApplicationError,c=1,u=!1,l=!1;a.makeEmitter(n),r.exports.MessageProcessor=n},{"./../errors":3,"./constants":6,"./event-emitter":7}],13:[function(e,r,t){function i(e,r){function t(e,r){var t=r?"0x":"";for(var i in e){var n=(255&e[i]).toString(16);1==n.length&&(n="0"+n),t+=n}return t}function i(e){for(var r in e)if(e.hasOwnProperty(r))return!1;return JSON.stringify(e)===JSON.stringify({})}function s(e,r){var t=r.params,i=e.original.params[n.kPeripheralUUID],a=e.original.params[n.kServiceUUID];i&&(t[n.kPeripheralUUID]=i),
a&&(t[n.kServiceUUID]=a)}a.instantiateEmitter(this);var o=this;this.processMessage=function(e){function t(t){var i=l[n.kPeripheralUUID],a={};if(a.peripheral=r.getPeripheral(i),a.peripheral&&a.peripheral.uuid){if("p"===t)return a;var s=l[n.kServiceUUID];if(a.service=a.peripheral.findService(s),a.service&&a.service.uuid){if("s"===t)return a;var c=l[n.kCharacteristicUUID];if(a.characteristic=a.service.findCharacteristic(c),a.characteristic&&a.characteristic.uuid){if("c"===t)return a;var u=l[n.kDescriptorUUID];if(a.descriptor=a.characteristic.findDescriptor(u),a.descriptor&&a.descriptor.uuid)return a;throw o.sendErrorResponse(e.method,n.kErrorDescriptorNotFound,"Descriptor not found in the service database"),new Error("Descriptor not found")}throw o.sendErrorResponse(e.method,n.kErrorCharacteristicNotFound,"Characteristic not found in the service database"),new Error("Characteristic not found")}throw o.sendErrorResponse(e.method,n.kErrorServiceNotFound,"Service not found in the service database"),new Error("Service not found")}throw o.sendErrorResponse(e.method,n.kErrorPeripheralNotFound,"Peripheral not found in the service database"),new Error("Peripheral not found")}var i;if("undefined"!=typeof e&&e&&!e.error){if(e.result&&(e.result==n.kMessage||e.result==n.kAuthenticate)){var a=!1;return e.error||"object"!=typeof e.params||e.params[n.kAuthenticate]!==!0||(a=!0),void o.emit("authenticated",a)}if(e.method&&e.method==n.kAuthenticate){var s={};s[n.kAuthenticate]=!0;var c={};return c.result=n.kAuthenticate,c.params=s,c[n.kIdField]=e[n.kIdField],c=JSON.stringify(c),void o.send(c)}var u={original:e},l=e.params;switch(e.method){case n.kConfigure:o.emit("configure",u,l[n.kShowPowerAlert],l[n.kIdentifierKey]);break;case n.kScanForPeripherals:o.emit("scan",u,l[n.kScanOptionAllowDuplicatesKey],l[n.kServiceUUIDs]);break;case n.kStopScanning:o.emit("stopScan",u);break;case n.kCentralState:o.emit("getCentralState",u);break;case n.kConnect:try{i=t("p"),o.emit("connect",u,i.peripheral.uuid)}catch(e){}break;case n.kDisconnect:try{i=t("p"),o.emit("disconnect",u,i.peripheral.uuid)}catch(e){}break;case n.kGetCharacteristicValue:try{i=t("c",u),o.emit("readCharacteristic",u,i.peripheral.uuid,i.service.uuid,i.characteristic.uuid)}catch(e){}break;case n.kWriteCharacteristicValue:try{i=t("c",u),o.emit("writeCharacteristic",u,i.peripheral.uuid,i.service.uuid,i.characteristic.uuid,e.params[n.kValue])}catch(e){}break;case n.kSetValueNotification:try{i=t("c",u),o.emit("enableNotifications",u,i.peripheral.uuid,i.service.uuid,i.characteristic.uuid,e.params[n.kIsNotifying])}catch(e){}break;case n.kGetDescriptorValue:try{i=t("d",u),o.emit("readDescriptor",u,i.peripheral.uuid,i.service.uuid,i.characteristic.uuid,i.descriptor.uuid)}catch(e){}break;case n.kWriteDescriptorValue:try{i=t("d",u),o.emit("writeDescriptor",u,i.peripheral.uuid,i.service.uuid,i.characteristic.uuid,i.descriptor.uuid,e.params[n.kValue])}catch(e){}break;default:return void o.sendErrorResponse(u,e.method,n.kInvalidRequest,"Request not handled by server")}}},o.sendErrorResponse=function(r,t,i,a){var s={},o={};o[n.kCode]=i,o[n.kMessageField]=a,s[n.kError]=o,s.result=t,r&&r.original&&(s[n.kMessageId]=r.original.id,s[n.kSessionId]=r.original.session_id),e.sendError(s)},o.configureResponse=function(r){r.result=n.kConfigure,e.respond(r,{})},o.centralStateResponse=function(r,t,i){var a={};a[n.kState]=t,r.result=n.kCentralState,e.respond(r,a)},o.stopScanResponse=function(r){r.result=n.kStopScanning,e.respond(r,{})},o.disconnectResponse=function(r,t){var i={};i[n.kPeripheralUUID]=t.uuid,i[n.kPeripheralName]=t.name,null!=r?e.respond(r,i):e.sendIndications(n.kDisconnect,i)},o.scanResponse=function(r,a,s,o,c,u,l,p){if(r)return r.result=n.kScanForPeripherals,void e.respond(r,{});var f,h,d={};if(!i(l)){f={};for(var v in l){var k=v.toUpperCase();f[k]=t(l[v]).toUpperCase()}}if(!i(p)){h={};for(var m in p){var E=m.toUpperCase();h[E]=t(p[m]).toUpperCase()}}d[n.kPeripheralName]=s,d[n.kPeripheralUUID]=a,d[n.kRSSIkey]=o,d[n.kCBAdvertisementDataTxPowerLevel]=c,d[n.kCBAdvertisementDataServiceUUIDsKey]=u&&u.length>0?u:void 0,d[n.kCBAdvertisementDataManufacturerDataKey]=f,d[n.kCBAdvertisementDataServiceDataKey]=h,e.sendIndications(n.kScanForPeripherals,d)},o.addPeripheral=function(e,r,t,i,n){var a=new Peripheral(this,e,r,t,i,n);return o.peripherals[a.uuid]=a,a},this.respondToConnect=function(r){var t={};s(r,t),e.respond(r,t)}}var n=e("./constants.js").C,a=e("./event-emitter");this.GATM_SECURITY_PROPERTIES_NO_SECURITY=0,this.GATM_SECURITY_PROPERTIES_UNAUTHENTICATED_ENCRYPTION_WRITE=1,this.GATM_SECURITY_PROPERTIES_AUTHENTICATED_ENCRYPTION_WRITE=2,this.GATM_SECURITY_PROPERTIES_UNAUTHENTICATED_ENCRYPTION_READ=4,this.GATM_SECURITY_PROPERTIES_AUTHENTICATED_ENCRYPTION_READ=8,this.GATM_SECURITY_PROPERTIES_UNAUTHENTICATED_SIGNED_WRITES=16,this.GATM_SECURITY_PROPERTIES_AUTHENTICATED_SIGNED_WRITES=32,this.GATM_CHARACTERISTIC_PROPERTIES_BROADCAST=1,this.GATM_CHARACTERISTIC_PROPERTIES_READ=2,this.GATM_CHARACTERISTIC_PROPERTIES_WRITE_WO_RESP=4,this.GATM_CHARACTERISTIC_PROPERTIES_WRITE=8,this.GATM_CHARACTERISTIC_PROPERTIES_NOTIFY=16,this.GATM_CHARACTERISTIC_PROPERTIES_INDICATE=32,this.GATM_CHARACTERISTIC_PROPERTIES_AUTHENTICATED_SIGNED_WRITES=64,this.GATM_CHARACTERISTIC_PROPERTIES_EXT_PROPERTIES=128,this.GATM_DESCRIPTOR_PROPERTIES_READ=1,this.GATM_DESCRIPTOR_PROPERTIES_WRITE=2,a.makeEmitter(i),r.exports.ServerMessageHandler=i},{"./constants.js":6,"./event-emitter":7}],14:[function(e,r,t){function i(e,r){var t=r[c.kDescriptorUUID],i=e.findDescriptor(t);i||(i=new p(e,t),e.addDescriptor(i)),i.value=r[c.kValue]}function n(e,r){var t=r[c.kCharacteristicUUID],n=e.findCharacteristic(t);n||(n=new l(e,t),e.addCharacteristic(n)),n.value=r[c.kValue];var a=r[c.kProperties];if("object"==typeof a)for(var s in a)n.setProperty(s,{enabled:a[s].enabled,name:a[s].name});else for(var o in c.AllProperties)n.setProperty([c.AllProperties[o]],{enabled:a>>o&1,name:c.AllProperties[o]});n.isNotifying=!1;var u=r[c.kDescriptors];if(u)for(var p in u){var f=u[p];i(n,f)}}function a(e,r){var t=r[c.kServiceUUID],i=e.findService(t);i||(i=new u(e,t),e.addService(i));var a=r[c.kCharacteristics];if(a)for(var s in a){var o=a[s];n(i,o)}}function s(e){var r={};if(e&&e.getAllDescriptors())for(var t in e.getAllDescriptors()){var i={};i[c.kDescriptorUUID]=t,i[c.kValue]=e.findDescriptor(t).value,i[c.kProperties]=e.findDescriptor(t).properties,i[c.kIsNotifying]=e.findDescriptor(t).isNotifying,r[t]=i}return r}function o(e){var r={};if(e&&e.getAllCharacteristics())for(var t in e.getAllCharacteristics()){var i={};i[c.kCharacteristicUUID]=t,i[c.kValue]=e.findCharacteristic(t).value,i[c.kProperties]=e.findCharacteristic(t).allProperties(),i[c.kIsNotifying]=e.findCharacteristic(t).isNotifying,i[c.kDescriptors]=s(e.findCharacteristic(t)),r[t]=i}return r}var c=e("./constants").C,u=e("./../service").Service,l=e("./../characteristic").Characteristic,p=e("./../descriptor").Descriptor;r.exports.parseServiceRecord=function(e,r){var t=r[c.kServices];if(t)for(var i in t){var n=t[i];a(e,n)}},r.exports.getServiceJsonFromPeripheralObject=function(e){var r={};if(e&&e.getAllServices())for(var t in e.getAllServices()){var i={};i[c.kServiceUUID]=t,i[c.kIsPrimaryKey]=e.findService(t).isPrimary,i[c.kCharacteristics]=o(e.findService(t)),r[t]=i}return r}},{"./../characteristic":1,"./../descriptor":2,"./../service":16,"./constants":6}],15:[function(e,r,t){function i(e,r){return e.indexOf(r)==-1&&(e.push(r),!0)}function n(e,r,t,n,p,f){c.instantiateEmitter(this);var h=this;this.type="p",this.uuid=r,this.isConnected=!1;var d={},v={},k={},m=[];this._updateFromScanData=function(e,r,t,n,a,s,c,u){this.name=e,this.rssi=r,this.txPowerLevel=t;if(a)for(var l in a)v[l]=a[l];if(k)for(var p in s)k[p]=s[p];if(n)for(var f=0;f<n.length;f++)i(m,n[f]);c&&o.parseAdvArray(h,c.c2)},this.findService=function(e){return d[e]},this.getMfrData=function(e){return v[e]},this.getSvcData=function(e){return k[e]},this.hasAdvertisedServiceUUID=function(e){return m.indexOf(e)>=0},this.getAllServices=function(){return d},this.getAllMfrData=function(){return v},this.getAllSvcData=function(){return k},this.getAllAdvertisedServiceUUIDs=function(){return m},this.addServiceWithUUID=function(e){var r=new l(h,e);return d[e]=r},this.addService=function(e){return d[e.uuid]=e},this.gattip=function(){return e},this.connectOnce=function(r){var t=s.populateParams(h);e.request(a.kConnect,t,r,function(t){u.parseServiceRecord(h,t),h.isConnected=!0,e.fulfill(r,h)})},this.connect=function(r,t){function i(t){s++,s<=a.NUM_CONNECT_ATTEMPTS?h.connectOnce({fulfill:n,reject:i}):e.reject(r,t)}var n="object"==typeof r?r.fulfill:r,s=0;t&&"number"==typeof t.numConnectAttempts&&(s=t.numConnectAttempts),i()},this.disconnect=function(r){var t=s.populateParams(h);e.request(a.kDisconnect,t,r,function(t){h.isConnected=!1,e.fulfill(r,h)})},this.respondToConnectRequest=function(r){var t={};t[a.kPeripheralUUID]=this.uuid,t[a.kPeripheralName]=this.name;var i;i=u.getServiceJsonFromPeripheralObject(this),t[a.kServices]=i,r.result=a.kConnect,e.respond(r,t)},this.handleDisconnectIndication=function(){h.isConnected=!1,h.emit("disconnected",h)},this._updateFromScanData(t,n,p,f)}var a=e("./lib/constants.js").C,s=e("./lib/message-helper"),o=e("./lib/message-advdata-parser"),c=e("./lib/event-emitter"),u=e("./lib/service-table"),l=e("./service").Service;c.makeEmitter(n),r.exports.Peripheral=n},{"./lib/constants.js":6,"./lib/event-emitter":7,"./lib/message-advdata-parser":9,"./lib/message-helper":11,"./lib/service-table":14,"./service":16}],16:[function(e,r,t){function i(e,r){var t=this,i=e.gattip(),s={};n.requireUUID("Service","uuid",r),this.uuid=r,this.type="s",this.isPrimary=!0,this.peripheral=function(){return e},this.gattip=function(){return i},this.getAllCharacteristics=function(){return s},this.findCharacteristic=function(e){return s[e]},this.addCharacteristicWithUUID=function(e,r){var i=new a(t,e,r);return s[e]=i},this.addCharacteristic=function(e){s[e.uuid]=e}}var n=e("./lib/message-helper"),a=e("./characteristic").Characteristic;t.Service=i},{"./characteristic":1,"./lib/message-helper":11}],17:[function(e,r,t){},{}],18:[function(e,r,t){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function a(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}r.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!a(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var r,t,i,a,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(r=arguments[1],r instanceof Error)throw r;throw TypeError('Uncaught, unspecified "error" event.')}if(t=this._events[e],o(t))return!1;if(n(t))switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),t.apply(this,a)}else if(s(t))for(a=Array.prototype.slice.call(arguments,1),u=t.slice(),i=u.length,c=0;c<i;c++)u[c].apply(this,a);return!0},i.prototype.addListener=function(e,r){var t;if(!n(r))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(r.listener)?r.listener:r),this._events[e]?s(this._events[e])?this._events[e].push(r):this._events[e]=[this._events[e],r]:this._events[e]=r,s(this._events[e])&&!this._events[e].warned&&(t=o(this._maxListeners)?i.defaultMaxListeners:this._maxListeners,t&&t>0&&this._events[e].length>t&&(this._events[e].warned=!0,"function"==typeof console.trace)),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,r){function t(){this.removeListener(e,t),i||(i=!0,r.apply(this,arguments))}if(!n(r))throw TypeError("listener must be a function");var i=!1;return t.listener=r,this.on(e,t),this},i.prototype.removeListener=function(e,r){var t,i,a,o;if(!n(r))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(t=this._events[e],a=t.length,i=-1,t===r||n(t.listener)&&t.listener===r)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,r);else if(s(t)){for(o=a;o-- >0;)if(t[o]===r||t[o].listener&&t[o].listener===r){i=o;break}if(i<0)return this;1===t.length?(t.length=0,delete this._events[e]):t.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,r)}return this},i.prototype.removeAllListeners=function(e){var r,t;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(r in this._events)"removeListener"!==r&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events={},this}if(t=this._events[e],n(t))this.removeListener(e,t);else if(t)for(;t.length;)this.removeListener(e,t[t.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){var r;return r=this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var r=this._events[e];if(n(r))return 1;if(r)return r.length}return 0},i.listenerCount=function(e,r){return e.listenerCount(r)}},{}],19:[function(e,r,t){"function"==typeof Object.create?r.exports=function(e,r){e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:r.exports=function(e,r){e.super_=r;var t=function(){};t.prototype=r.prototype,e.prototype=new t,e.prototype.constructor=e}},{}],20:[function(e,r,t){function i(){l&&o&&(l=!1,o.length?u=o.concat(u):p=-1,u.length&&n())}function n(){if(!l){var e=setTimeout(i);l=!0;for(var r=u.length;r;){for(o=u,u=[];++p<r;)o&&o[p].run();p=-1,r=u.length}o=null,l=!1,clearTimeout(e)}}function a(e,r){this.fun=e,this.array=r}function s(){}var o,c=r.exports={},u=[],l=!1,p=-1;c.nextTick=function(e){var r=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)r[t-1]=arguments[t];u.push(new a(e,r)),1!==u.length||l||setTimeout(n,0)},a.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=s,c.addListener=s,c.once=s,c.off=s,c.removeListener=s,c.removeAllListeners=s,c.emit=s,c.binding=function(e){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(e){throw new Error("process.chdir is not supported")},c.umask=function(){return 0}},{}],21:[function(e,r,t){r.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],22:[function(e,r,t){(function(r,i){function n(e,r){var i={seen:[],stylize:s};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),v(r)?i.showHidden=r:r&&t._extend(i,r),S(i.showHidden)&&(i.showHidden=!1),S(i.depth)&&(i.depth=2),S(i.colors)&&(i.colors=!1),S(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=a),c(i,e,i.depth)}function a(e,r){var t=n.styles[r];return t?"["+n.colors[t][0]+"m"+e+"["+n.colors[t][1]+"m":e}function s(e,r){return e}function o(e){var r={};return e.forEach(function(e,t){r[e]=!0}),r}function c(e,r,i){if(e.customInspect&&r&&C(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var n=r.inspect(i,e);return I(n)||(n=c(e,n,i)),n}var a=u(e,r);if(a)return a;var s=Object.keys(r),v=o(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(r)),T(r)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return l(r);if(0===s.length){if(C(r)){var k=r.name?": "+r.name:"";return e.stylize("[Function"+k+"]","special")}if(P(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(A(r))return e.stylize(Date.prototype.toString.call(r),"date");if(T(r))return l(r)}var m="",E=!1,g=["{","}"];if(d(r)&&(E=!0,g=["[","]"]),C(r)){var S=r.name?": "+r.name:"";m=" [Function"+S+"]"}if(P(r)&&(m=" "+RegExp.prototype.toString.call(r)),A(r)&&(m=" "+Date.prototype.toUTCString.call(r)),T(r)&&(m=" "+l(r)),0===s.length&&(!E||0==r.length))return g[0]+m+g[1];if(i<0)return P(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special");e.seen.push(r);var y;return y=E?p(e,r,i,v,s):s.map(function(t){return f(e,r,i,v,t,E)}),e.seen.pop(),h(y,m,g)}function u(e,r){if(S(r))return e.stylize("undefined","undefined");if(I(r)){var t="'"+JSON.stringify(r).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(t,"string")}return E(r)?e.stylize(""+r,"number"):v(r)?e.stylize(""+r,"boolean"):k(r)?e.stylize("null","null"):void 0}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,r,t,i,n){for(var a=[],s=0,o=r.length;s<o;++s)R(r,String(s))?a.push(f(e,r,t,i,String(s),!0)):a.push("");return n.forEach(function(n){n.match(/^\d+$/)||a.push(f(e,r,t,i,n,!0))}),a}function f(e,r,t,i,n,a){var s,o,u;if(u=Object.getOwnPropertyDescriptor(r,n)||{value:r[n]},u.get?o=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(o=e.stylize("[Setter]","special")),R(i,n)||(s="["+n+"]"),o||(e.seen.indexOf(u.value)<0?(o=k(t)?c(e,u.value,null):c(e,u.value,t-1),o.indexOf("\n")>-1&&(o=a?o.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+o.split("\n").map(function(e){return"   "+e}).join("\n"))):o=e.stylize("[Circular]","special")),S(s)){if(a&&n.match(/^\d+$/))return o;s=JSON.stringify(""+n),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+o}function h(e,r,t){var i=0,n=e.reduce(function(e,r){return i++,r.indexOf("\n")>=0&&i++,e+r.replace(/\u001b\[\d\d?m/g,"").length+1},0);return n>60?t[0]+(""===r?"":r+"\n ")+" "+e.join(",\n  ")+" "+t[1]:t[0]+r+" "+e.join(", ")+" "+t[1]}function d(e){return Array.isArray(e)}function v(e){return"boolean"==typeof e}function k(e){return null===e}function m(e){return null==e}function E(e){return"number"==typeof e}function I(e){return"string"==typeof e}function g(e){return"symbol"==typeof e}function S(e){return void 0===e}function P(e){return y(e)&&"[object RegExp]"===_(e)}function y(e){return"object"==typeof e&&null!==e}function A(e){return y(e)&&"[object Date]"===_(e)}function T(e){return y(e)&&("[object Error]"===_(e)||e instanceof Error)}function C(e){return"function"==typeof e}function D(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function _(e){return Object.prototype.toString.call(e)}function R(e,r){return Object.prototype.hasOwnProperty.call(e,r)}var U=/%[sdj%]/g;t.format=function(e){if(!I(e)){for(var r=[],t=0;t<arguments.length;t++)r.push(n(arguments[t]));return r.join(" ")}for(var t=1,i=arguments,a=i.length,s=String(e).replace(U,function(e){if("%%"===e)return"%";if(t>=a)return e;switch(e){case"%s":return String(i[t++]);case"%d":return Number(i[t++]);case"%j":try{return JSON.stringify(i[t++])}catch(e){return"[Circular]"}default:return e}}),o=i[t];t<a;o=i[++t])s+=k(o)||!y(o)?" "+o:" "+n(o);return s},t.deprecate=function(e,n){function a(){if(!s){if(r.throwDeprecation)throw new Error(n);r.traceDeprecation,s=!0}return e.apply(this,arguments)}if(S(i.process))return function(){return t.deprecate(e,n).apply(this,arguments)};if(r.noDeprecation===!0)return e;var s=!1;return a};var b,w={};t.debuglog=function(e){if(S(b)&&(b=r.env.NODE_DEBUG||""),e=e.toUpperCase(),!w[e])if(new RegExp("\\b"+e+"\\b","i").test(b)){r.pid;w[e]=function(){t.format.apply(t,arguments)}}else w[e]=function(){};return w[e]},t.inspect=n,n.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},n.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=d,t.isBoolean=v,t.isNull=k,t.isNullOrUndefined=m,t.isNumber=E,t.isString=I,t.isSymbol=g,t.isUndefined=S,t.isRegExp=P,t.isObject=y,t.isDate=A,t.isError=T,t.isFunction=C,t.isPrimitive=D,t.isBuffer=e("./support/isBuffer");t.log=function(){},t.inherits=e("inherits"),t._extend=function(e,r){if(!r||!y(r))return e;for(var t=Object.keys(r),i=t.length;i--;)e[t[i]]=r[t[i]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":21,_process:20,inherits:19}],"gatt-ip":[function(e,r,t){r.exports.GATTIP=e("./gattip").GATTIP,r.exports.GattIpServer=e("./lib/gattip-server").GattIpServer},{"./gattip":5,"./lib/gattip-server":8}]},{},[]);